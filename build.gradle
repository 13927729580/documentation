ext.docVersion = '6.3'

repositories {
    mavenLocal()
    maven {
        credentials {
            username System.getenv('HAULMONT_REPOSITORY_USER')
            password System.getenv('HAULMONT_REPOSITORY_PASSWORD')
        }
        url "http://repository.haulmont.com:8587/nexus/content/groups/work"
    }
}

apply(plugin: 'idea')
apply(plugin: 'doc')

task clean(type: Delete) {
    delete 'build', 'buildSrc/build'
}

task buildCubaTheme(type: BuildAsciidoctorTheme) {
    themeName = 'cuba'
}

/* ============= Manual =================*/

task generateManualHtmlEn(type: Asciidoc2Html) {
    docName = 'manual'
    docLang = 'en'
}

task generateManualHtmlRu(type: Asciidoc2Html) {
    docName = 'manual'
    docLang = 'ru'
}

task postProcessManualEn(type: PostProcessDocHtml) {
    docName = 'manual'
    docLang = 'en'
}

task postProcessManualRu(type: PostProcessDocHtml) {
    docName = 'manual'
    docLang = 'ru'
}

task buildManualEn(dependsOn: [generateManualHtmlEn, postProcessManualEn])

task buildManualRu(dependsOn: [generateManualHtmlRu, postProcessManualRu])

task chopManualEn(dependsOn: [buildManualEn], type: CreateMultiPageDoc) {
    docName = 'manual'
    docLang = 'en'
    docTitle = "<a href='https://www.cuba-platform.com/manual' target='_blank'>CUBA Platform</a>. Developer’s Manual"
}

task chopManualRu(dependsOn: [buildManualRu], type: CreateMultiPageDoc) {
    docName = 'manual'
    docLang = 'ru'
    docTitle = "<a href='https://www.cuba-platform.ru/manual' target='_blank'>Платформа CUBA</a>. Руководство по разработке приложений"
}

task warManualEn(dependsOn: [chopManualEn], type: CreateWar) {
    docName = 'manual'
    docLang = 'en'
}

task warManualRu(dependsOn: [chopManualRu], type: CreateWar) {
    docName = 'manual'
    docLang = 'ru'
}

/* ============= Reporting =================*/

task generateReportingHtmlEn(type: Asciidoc2Html) {
    docName = 'reporting'
    docLang = 'en'
}

task generateReportingHtmlRu(type: Asciidoc2Html) {
    docName = 'reporting'
    docLang = 'ru'
}

task postProcessReportingEn(type: PostProcessDocHtml) {
    docName = 'reporting'
    docLang = 'en'
}

task postProcessReportingRu(type: PostProcessDocHtml) {
    docName = 'reporting'
    docLang = 'ru'
}

task buildReportingEn(dependsOn: [generateReportingHtmlEn, postProcessReportingEn])

task buildReportingRu(dependsOn: [generateReportingHtmlRu, postProcessReportingRu])

task chopReportingEn(dependsOn: [buildReportingEn], type: CreateMultiPageDoc) {
    docName = 'reporting'
    docLang = 'en'
    docTitle = "<a href='https://www.cuba-platform.com/manual' target='_blank'>CUBA Platform</a>. Report Generator"
}

task chopReportingRu(dependsOn: [buildReportingRu], type: CreateMultiPageDoc) {
    docName = 'reporting'
    docLang = 'ru'
    docTitle = "<a href='https://www.cuba-platform.ru/manual' target='_blank'>Платформа CUBA</a>. Генератор отчетов"
}

task warReportingEn(dependsOn: [chopReportingEn], type: CreateWar) {
    docName = 'reporting'
    docLang = 'en'
}

task warReportingRu(dependsOn: [chopReportingRu], type: CreateWar) {
    docName = 'reporting'
    docLang = 'ru'
}

/* ============= Workflow =================*/

task generateWorkflowHtmlEn(type: Asciidoc2Html) {
    docName = 'workflow'
    docLang = 'en'
}

task generateWorkflowHtmlRu(type: Asciidoc2Html) {
    docName = 'workflow'
    docLang = 'ru'
}

task postProcessWorkflowEn(type: PostProcessDocHtml) {
    docName = 'workflow'
    docLang = 'en'
}

task postProcessWorkflowRu(type: PostProcessDocHtml) {
    docName = 'workflow'
    docLang = 'ru'
}

task buildWorkflowEn(dependsOn: [generateWorkflowHtmlEn, postProcessWorkflowEn])

task buildWorkflowRu(dependsOn: [generateWorkflowHtmlRu, postProcessWorkflowRu])

/* ============= Charts =================*/

task generateChartsHtmlEn(type: Asciidoc2Html) {
    docName = 'charts'
    docLang = 'en'
}

task generateChartsHtmlRu(type: Asciidoc2Html) {
    docName = 'charts'
    docLang = 'ru'
}

task postProcessChartsEn(type: PostProcessDocHtml) {
    docName = 'charts'
    docLang = 'en'
}

task postProcessChartsRu(type: PostProcessDocHtml) {
    docName = 'charts'
    docLang = 'ru'
}

task buildChartsEn(dependsOn: [generateChartsHtmlEn, postProcessChartsEn])

task buildChartsRu(dependsOn: [generateChartsHtmlRu, postProcessChartsRu])

task chopChartsEn(dependsOn: [buildChartsEn], type: CreateMultiPageDoc) {
    docName = 'charts'
    docLang = 'en'
    docTitle = "<a href='https://www.cuba-platform.com/manual' target='_blank'>CUBA Platform</a>. Displaying Charts And Maps"
}

task chopChartsRu(dependsOn: [buildChartsRu], type: CreateMultiPageDoc) {
    docName = 'charts'
    docLang = 'ru'
    docTitle = "<a href='https://www.cuba-platform.ru/manual' target='_blank'>Платформа CUBA</a>. Отображение диаграмм и карт"
}

task warChartsEn(dependsOn: [chopChartsEn], type: CreateWar) {
    docName = 'charts'
    docLang = 'en'
}

task warChartsRu(dependsOn: [chopChartsRu], type: CreateWar) {
    docName = 'charts'
    docLang = 'ru'
}

/* ============= FTS =================*/
task generateFtsHtmlEn(type: Asciidoc2Html) {
    docName = 'fts'
    docLang = 'en'
}

task generateFtsHtmlRu(type: Asciidoc2Html) {
    docName = 'fts'
    docLang = 'ru'
}

task postProcessFtsEn(type: PostProcessDocHtml) {
    docName = 'fts'
    docLang = 'en'
}

task postProcessFtsRu(type: PostProcessDocHtml) {
    docName = 'fts'
    docLang = 'ru'
}

task buildFtsEn(dependsOn: [generateFtsHtmlEn, postProcessFtsEn])

task buildFtsRu(dependsOn: [generateFtsHtmlRu, postProcessFtsRu])

task chopFtsEn(dependsOn: [buildFtsEn], type: CreateMultiPageDoc) {
    docName = 'fts'
    docLang = 'en'
    docTitle = "<a href='https://www.cuba-platform.com/manual' target='_blank'>CUBA Platform</a>. Full Text Search"
}

task chopFtsRu(dependsOn: [buildFtsRu], type: CreateMultiPageDoc) {
    docName = 'fts'
    docLang = 'ru'
    docTitle = "<a href='https://www.cuba-platform.ru/manual' target='_blank'>Платформа CUBA</a>. Полнотекстовый поиск"
}

task warFtsEn(dependsOn: [chopFtsEn], type: CreateWar) {
    docName = 'fts'
    docLang = 'en'
}

task warFtsRu(dependsOn: [chopFtsRu], type: CreateWar) {
    docName = 'fts'
    docLang = 'ru'
}

/* ============= BPM =================*/

task generateBpmHtmlEn(type: Asciidoc2Html) {
    docName = 'bpm'
    docLang = 'en'
}

task generateBpmHtmlRu(type: Asciidoc2Html) {
    docName = 'bpm'
    docLang = 'ru'
}

task postProcessBpmEn(type: PostProcessDocHtml) {
    docName = 'bpm'
    docLang = 'en'
}

task postProcessBpmRu(type: PostProcessDocHtml) {
    docName = 'bpm'
    docLang = 'ru'
}

task buildBpmEn(dependsOn: [generateBpmHtmlEn, postProcessBpmEn])

task buildBpmRu(dependsOn: [generateBpmHtmlRu, postProcessBpmRu])

task chopBpmEn(dependsOn: [buildBpmEn], type: CreateMultiPageDoc) {
    docName = 'bpm'
    docLang = 'en'
    docTitle = "<a href='https://www.cuba-platform.com/manual' target='_blank'>CUBA Platform</a>. Business Process Management"
}

task chopBpmRu(dependsOn: [buildBpmRu], type: CreateMultiPageDoc) {
    docName = 'bpm'
    docLang = 'ru'
    docTitle = "<a href='https://www.cuba-platform.ru/manual' target='_blank'>Платформа CUBA</a>. Управление бизнес процессами"
}

task warBpmEn(dependsOn: [chopBpmEn], type: CreateWar) {
    docName = 'bpm'
    docLang = 'en'
}

task warBpmRu(dependsOn: [chopBpmRu], type: CreateWar) {
    docName = 'bpm'
    docLang = 'ru'
}

/* ============= Build all =================*/

task buildManualAll(dependsOn: [buildManualEn, buildManualRu])
task chopManualAll(dependsOn: [chopManualEn, chopManualRu])
task warManualAll(dependsOn: [warManualEn, warManualRu])

task buildReportingAll(dependsOn: [buildReportingEn, buildReportingRu])
task chopReportingAll(dependsOn: [chopReportingEn, chopReportingRu])
task warReportingAll(dependsOn: [warReportingEn, warReportingRu])

task buildWorkflowAll(dependsOn: [buildWorkflowEn, buildWorkflowRu])

task buildChartsAll(dependsOn: [buildChartsEn, buildChartsRu])
task chopChartsAll(dependsOn: [chopChartsEn, chopChartsRu])
task warChartsAll(dependsOn: [warChartsEn, warChartsRu])

task buildFtsAll(dependsOn: [buildFtsEn, buildFtsRu])
task chopFtsAll(dependsOn: [chopFtsEn, chopFtsRu])
task warFtsAll(dependsOn: [warFtsEn, warFtsRu])

task buildBpmAll(dependsOn: [buildBpmEn, buildBpmRu])
task chopBpmAll(dependsOn: [chopBpmEn, chopBpmRu])
task warBpmAll(dependsOn: [warBpmEn, warBpmRu])
