= CUBA Platform and Studio Release Notes
:toc: left
:toc-title: Table of contents
:toclevels: 6
:sectnumlevels: 6
:stylesheet: cuba.css
:linkcss:
:source-highlighter: coderay
:imagesdir: ./img
:stylesdir: ./styles
:sourcesdir: ../../source
:doctype: book
:sectlinks:
:sectanchors:
:lang: en
:revnumber: 6.7
:version-label: Version
:revremark: Copyright (c) 2017 Haulmont
:youtrack: https://youtrack.cuba-platform.com
:manual: https://doc.cuba-platform.com/manual-{revnumber}
:manual_app_props: https://doc.cuba-platform.com/manual-{revnumber}/app_properties_reference.html#
:reporting: https://doc.cuba-platform.com/reporting-{revnumber}

:!sectnums:

[[overview]]
== Overview

This document highlights major changes in CUBA Platform and Studio version {revnumber}.

[[platform]]
== Platform

=== All Resolved Issues

* https://youtrack.cuba-platform.com/issues/PL?q=Milestone:%20%7BRelease%206.7%7D%20State:%20Fixed,%20Verified%20Fix%20versions:%206.7.0%20Affected%20versions:%20-SNAPSHOT%20sort%20by:%20created%20asc[Platform 6.7.0 Resolved Issues]


[[platform_breaking_changes]]
=== Breaking Changes

. Due to improvements in <<datatype,datatypes>>, a migration of custom datatypes is needed. Studio does it automatically when you switch to the new platform version. If you don't use Studio and your project has custom datatypes registered in `metadata.xml`, add `id` attribute to the `datatype` element and set it to the value of the `NAME` constant of your datatype class. For example:
+
[source, xml]
----
<datatype id="year" class="com.company.sample.YearDatatype"/>
----

[[data_model]]
=== Data Model

[[entity_base_classes]]
==== Base Classes

Non-persistent entities should be inherited form the same {manual}/base_entity_classes.html[base classes] as persistent ones: `BaseUuidEntity`, `BaseLongIdEntity`, and so on. It allows you to have identifiers of any type, which is important when non-persistent entities represent data from some data store. The framework determines if the entity is persistent or not by the file where it is registered: `persistence.xml` or `metadata.xml`.

`AbstractNotPersistentEntity` has been deprecated, but can still be used for backward compatibility.

[[number_format]]
==== Number Format

Using the new {manual}/entity_attr_annotations.html#numberFormat_annotation[@NumberFormat] annotation, you can define a display format for numeric attributes right in the entity class. So if you need just a specific formatting of an attribute, and don't need some custom conversion algorithm, then you don't have to create a {manual}/datatype.html[Datatype] for the attribute. For example, here is an integer number without grouping separators:

[source, java]
----
@Column(name = "SIMPLE_NUMBER")
@NumberFormat(pattern = "#")
protected Integer simpleNumber;
----

[[datatype]]
==== Datatypes

The {manual}/datatype.html[datatypes] mechanism has been improved for better extensibility.

The `getName()` method of the `Datatype` interface is deprecated, and implementation classes do not need the `NAME` constant. Instead, the `id` XML attribute is used when the implementation class is registered.

The `getJavaClass()` method of the `Datatype` interface now has a default implementation that returns a value of the `@JavaClass` annotation if it is present on the class.

All datatypes are registered in `metadata.xml` files, but if old `datatypes.xml` exists, it is loaded for backward compatibility.

There is no hard-coded list of "standard datatypes" anymore. The `default` XML attribute in `metadata.xml` indicates that the datatype should be used by default for a Java class handled by this datatype, i.e. this datatype will be resolved automatically for entity attributes of appropriate type. Standard datatypes are defined in the `cuba-metadata.xml` of the `cuba` application component. Subsequent `metadata.xml` files can add and override any datatype including default ones.

The `Datatypes` class became a thin wrapper delegating to the `DatatypeRegistry` and `FormatStringsRegistry` beans. It is recommended to use `DatatypeRegistry` directly. Its `getId*()` methods are designed to get an id the datatype is registered with.

[[gui]]
=== Generic UI

[[lookup_screen_customization]]
==== Lookup Screen Customization

When a browse screen is opened as a lookup, it contains an automatically added panel with buttons and a special lookup action. Now you can customize all these parts: replace the frame with buttons for all lookup screens in your project, create your own selection buttons for a certain screen, or customize the lookup action. See details in the {manual}/screen_lookup.html#screen_lookup_customization[documentation].

[[misc]]
=== Miscellaneous

[[reporting]]
=== Reporting

[[upd_dep]]
=== Updated Dependencies

Java libraries:
----
ch.qos.logback/logback-classic = 1.2.3
com.fasterxml.jackson = 2.8.8.1
com.fasterxml.jackson.dataformat/jackson-dataformat-yaml = 2.8.8
com.google.code.findbugs/jsr305 = 3.0.2
com.vaadin = 7.7.10.cuba.0
commons-collections/commons-collections = 3.2.2
mysql/mysql-connector-java = 5.1.41
org.apache.commons/commons-compress = 1.13
org.apache.tomcat/tomcat-servlet-api = 8.0.43
org.codehaus.groovy/groovy-all = 2.4.10
org.hibernate/hibernate-validator = 5.4.1.Final
org.slf4j/log4j-over-slf4j = 1.7.25
org.springframework = 4.3.8.RELEASE
org.springframework.ldap/spring-ldap-core = 2.3.1.RELEASE
org.springframework.security = 4.2.2.RELEASE
org.springframework.security.oauth/spring-security-oauth2 = 2.1.0.RELEASE
org.thymeleaf = 3.0.5.RELEASE
org.thymeleaf.extras/thymeleaf-extras-springsecurity4 = 3.0.2.RELEASE
tomcat = 8.5.14
----

JavaScript libraries:
----
node.js = 8.1.2
npm = 5.0.3
----

[[studio]]
== Studio

=== All Resolved Issues

* https://youtrack.cuba-platform.com/issues/STUDIO?q=Milestone:%20%7BRelease%206.7%7D%20State:%20Fixed,%20Verified%20Fix%20versions:%206.7.0%20Affected%20versions:%20-SNAPSHOT%20sort%20by:%20created%20asc[Studio 6.7.0 Resolved Issues]

[[studio_breaking_changes]]
=== Breaking Changes


[[studio_repositories]]
=== Repository Configuration

