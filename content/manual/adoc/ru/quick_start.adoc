[[quick_start]]
== Быстрый старт

В данном разделе рассматривается создание приложения при помощи CUBA Studio. Эта же информация изложена в видеороликах, доступных по адресу link:$$https://www.cuba-platform.ru/quickstart$$[www.cuba-platform.ru/quickstart].

На Вашей рабочей машине уже должно быть установлено и настроено необходимое программное обеспечение, см. <<setup,>>.

Основные задачи, стоящие при разработке нашего приложения:

. Разработка модели данных, которая заключается в создании сущностей предметной области и соответствующих таблиц базы данных.

. Разработка экранов пользовательского интерфейса, позволяющих создавать, просматривать, обновлять и удалять сущности модели данных.

[[qs_app_details]]
=== Описание задачи

Приложение предназначено для ведения сведений о покупателях и их заказах. 

Покупатель имеет следующие характеристики:

* Имя

* Электронная почта

Характеристики заказа:

* Принадлежность покупателю

* Дата

* Сумма

image::quick_start_1.png[align="center"]

Пользовательский интерфейс приложения должен содержать:

* Окно списка покупателей;

* Окно редактирования сведений о покупателе, содержащее также список заказов данного покупателя;

* Окно общего списка заказов;

* Окно редактирования заказа.

[[qs_create_project]]
=== Создание проекта

. Запустите *CUBA Studio* и откройте ее веб-интерфейс (см. <<cubaStudio_install,Установка CUBA Studio>>).

. Нажмите на кнопку *Create new*.

. В окне *New project* в поле *Project name* введите имя проекта - `sales`. Имя должно содержать только латинские буквы, цифры и знак подчеркивания. Тщательно продумайте имя проекта на данном этапе, так как в дальнейшем изменить его будет достаточно сложно.

. В полях ниже автоматически сгенерируются:

* *Project path* − путь к каталогу нового проекта. Каталог можно выбрать вручную, нажав на кнопку `*...*` рядом с полем. Отобразится окно *Folder select* со списком папок на жестком диске. Вы можете выбрать одну из них или создать новый каталог, нажав на кнопку *+*.

* *Project namespace* - пространство имен, которое будет использоваться как префикс имен сущностей и таблиц базы данных. Пространство имен может состоять только из латинских букв, и должно быть как можно короче. Например, если имя проекта - `++sales_2++`, то пространство имен может быть `sales` или `sal`.

* *Root package* − корневой пакет Java-классов. Может быть скорректирован позже, однако сгенерированные на этапе создания классы перемещены не будут.

* *Repository* − URL и параметры аутентификации <<artifact_repository,репозитория>> бинарных артефактов.

* *Platform version* - используемая в проекте версия платформы. Артефакты платформы будут автоматически загружены из репозитория при сборке проекта.
+
image::qs_new_project.png[align="center"]

. Нажмите на кнопку *OK*. В указанном каталоге `sales` будет создан пустой проект, и откроется главное окно Studio.

. Сборка проекта. Выберите пункт главного меню Studio *Build* → *Assemble project*. На этом этапе будут загружены все необходимые библиотеки, и в подкаталогах `build` модулей будут собраны <<artifact,артефакты>> проекта.

. Создание базы данных на локальном сервере *HyperSQL*. Выберите пункт меню *Run* → *Create database*. Имя БД по умолчанию совпадает с пространством имен проекта.

. Выберите пункт меню *Run* → *Deploy*. В подкаталоге `deploy` проекта будет установлен сервер *Tomcat* с собранным приложением.

. Выберите пункт меню *Run* → *Start application server*. Через несколько секунд в панели статуса ссылка рядом с надписью *Web application* станет доступной, и по ней можно осуществить переход к приложению непосредственно из Studio.
+
Логин и пароль пользователя − `admin` / `admin`.
+
Запущенное приложение содержит два главных пункта меню (*Administration* и *Help*), функциональность подсистемы безопасности и администрирования системы.

[[qs_create_entities]]
=== Создание сущностей

Создадим класс сущности Customer (Покупатель).

* Перейдите на вкладку *Data Model* на панели навигатора и нажмите на кнопку *New* > *Entity*. Появится диалоговое окно *New entity*.

* В поле *Class name* введите название класса сущности − `Customer`.
+
image::qs_create_customer_entity.png[align="center"]

* Нажмите *OK*. В рабочей области откроется страница дизайнера сущности.
+
image::qs_customer_entity.png[align="center"]

* В полях *Name* и *Table* автоматически сгенерируются имя сущности и имя таблицы в базе данных.

* В поле *Parent class* оставьте установленное значение − `StandardEntity`.

* Поле *Inheritance strategy* оставьте пустым.

Далее создадим атрибуты сущности. Для этого нажмите на кнопку *New*, находящуюся под таблицей *Attributes*.

* В отобразившемся окне *Create attribute* в поле *Name* введите название атрибута сущности − `name`, в списке *Attribute type* выберите значение `DATATYPE`, в поле *Type* укажите тип атрибута `String` и далее укажите длину текстового атрибута в поле *Length*, равной 100 символам. Установите флажок *Mandatory*. В поле *Column* автоматически сгенерируется имя колонки таблицы в базе данных.
+
image::qs_new_attribute.png[align="center"]
+
Для добавления атрибута нажмите на кнопку *Add*.

* Атрибут `email` создается таким же образом, за исключением того, что в поле *Length* следует указать значение `50`.

После создания атрибутов перейдите на вкладку *Instance Name* дизайнера сущности для задания <<namePattern_annotation,Name pattern>>. В списке *Available attributes* выделите атрибут `name` и перенесите его в список *Name pattern attributes*, нажав на кнопку с изображением стрелки вправо.

image::qs_customer_instance_name.png[align="center"]

На этом создание сущности Customer завершено. Нажмите на кнопку *OK* в верхней панели для сохранения изменений.

Создадим сущность Order (Заказ). В панели *DATA MODEL* нажмите на кнопку *New* > *Entity*. В поле *Class name* введите название класса сущности − `Order`. Сущность должна иметь следующие атрибуты:

* *Name* − `customer`, *Attribute type* − `ASSOCIATION`, *Type* − `Customer`, *Cardinality* − `++MANY_TO_ONE++`.

* *Name* − `date`, *Attribute type* − `DATATYPE`, *Type* − `Date`. Для атрибута `date` установите флажок *Mandatory*.

* *Name* − `amount`, *Attribute type* − `DATATYPE`, *Type* − `BigDecimal`.

[[qs_create_db_tables]]
=== Создание таблиц базы данных

Для <<db_update_in_dev,создания таблиц базы данных>> достаточно на вкладке *Data Model* панели навигатора нажать на кнопку *Generate DB scripts*. После этого откроется страница *Database Scripts*. На вкладке будут сгенерированы скрипты обновления базы данных от ее текущего состояния (*UPDATE SCRIPTS*) и скрипты создания базы данных с нуля (*INIT TABLES*, *INIT TABLES*, *INIT DATA*). Также на вкладке будут доступны уже выполненные скрипты обновления базы данных, если они есть.

image::qs_generate_db_scripts.png[align="center"]

Чтобы сохранить сгенерированные скрипты, нажмите на кнопку *Save and close*. Для запуска скриптов обновления остановите запущенное приложение с помощью команды *Run* → *Stop application server*, затем выполните *Run* → *Update database*.

[[qs_create_ui]]
=== Создание экранов пользовательского интерфейса

Создадим экраны приложения, позволяющие управлять информацией о покупателях и заказах.

[[qs_create_customer_screens]]
==== Экраны управления Покупателями

Для создания стандартных экранов просмотра и редактирования покупателей необходимо выделить сущность `Customer` на вкладке *Data Model* панели навигатора и нажать на кнопку *New* > *Generic UI screen* внизу панели. После этого на экране отобразится страница создания стандартных экранов сущности.

В списке доступных шаблонов выберите *Entity browser and editor screens*.

image::qs_create_customer_screens.png[align="center"]

Все поля этого окна заполнены значениями по умолчанию, пока не будем их менять. Нажмите на кнопку *Create* и затем *Close*.

Во вкладке *Generic UI* панели навигатора в модуле *Web Module* появятся элементы `customer-browse.xml` и `customer-edit.xml`.

[[qs_create_order_screens]]
==== Экраны управления Заказами

Сущность Order (Заказ) имеет следующую особенность: так как среди прочих атрибутов существует ссылочный атрибут `Order.customer`, требуется определить <<views,представление>> сущности `Order`, включающее этот атрибут (стандартное представление `++_local++` не включает ссылочных атрибутов).

Для этого перейдите на вкладку *Data Model* на панели навигатора, выделите сущность `Order` и выберите *New* > *View*. Отобразится страница дизайнера представлений. В качестве имени введите `order-with-customer`, в списке атрибутов нажмите на атрибут `customer` и на отобразившейся справа панели выберите представление `++_minimal++` для сущности `Customer`.

image::qs_order_view.png[align="center"]

Нажмите на кнопку *OK* в верхней панели.

Далее выделите сущность `Order` и выберите *New* > *Generic UI screen*.

В отобразившемся окне выберите представление `order-with-customer` в полях *View* для браузера и редактора и нажмите на кнопку *Create* и, затем, *Close*.

image::qs_create_order_screens.png[align="center"]

Во вкладке *Generic UI* панели навигатора в модуле *Web Module* появятся элементы `order-edit.xml` и `order-browse.xml`.

[[qs_create_menu]]
==== Меню приложения

При создании экраны были добавлены в пункт меню *application*, имеющийся по умолчанию. Переименуем его. Для этого перейдите на вкладку *Generic UI* на панели навигатора и нажмите на ссылку *Open web menu*. Отобразится страница дизайнера меню. Выделите пункт меню `application-sales` для просмотра его свойств.

В поле *Id* введите новое значение идентификатора меню − `shop`. После редактирования меню нажмите на кнопку *OK* в верхней панели.

image::qs_application_menu.png[align="center"]

[[qs_customer_edit_with_orders]]
==== Экран редактирования Покупателя со списком Заказов

Займемся задачей отображения списка заказов в окне редактирования покупателя.

* Перейдите на вкладку *Generic UI* на панели навигатора. Выделите экран `customer-edit.xml` и нажмите на кнопку *Edit*.

* На странице дизайнера экрана перейдите на вкладку *Datasources* и нажмите на кнопку *New*.

* Выделите только что созданный <<datasources,источник данных>> в списке. В правой части страницы отобразятся его характеристики.

* В поле *Type* укажите `collectionDatasource`.

* В списке *Entity* выберите сущность `Order`.

* В поле *Id* будет автоматически заполнено значение идентификатора источника данных − `ordersDs`.

* В списке *View* выберите представление `++_local++`.

* В поле *Query* введите следующий <<datasource_query,запрос>>:
+
[source, jpql]
----
select e from sales$Order e where e.customer.id = :ds$customerDs order by e.date
----
+
Здесь запрос содержит условие отбора Заказов с <<datasource_query_params,параметром>> `ds$customerDs`. Значением параметра с именем вида `++ds${datasource_name}++` будет идентификатор сущности, установленной в данный момент в источнике данных `++datasource_name++`, в данном случае − идентификатор редактируемого Покупателя.
+
image::qs_customer_screen_orders_ds.png[align="center"]

* Нажмите на кнопку *Apply* для сохранения изменений.

* Далее перейдите на вкладку *Layout* в дизайнере экрана и в палитре компонентов найдите компонент `Label`. Перетащите этот компонент на панель иерархии компонентов экрана, между `fieldGroup` и `windowActions`. Перейдите на вкладку *Properties* на панели свойств. В поле *value* введите значение компонента: `Orders`.
+
image::qs_customer_screen_label.png[align="center"]
+
[TIP]
====
Если разрабатываемое приложение предполагает локализацию на несколько языков, используйте кнопку image:localization.png[] рядом с полем *value*, чтобы создать новое <<messages,сообщение>> `msg://orders` и задать его значение на требуемых языках.
====

* Перетащите компонент `Table` из палитры компонентов на панель иерархии компонентов между `label` и `windowActions`. Выделите компонент в иерархии и перейдите на вкладку *Properties*. Задайте размеры таблицы: в поле *width* укажите `100%`, в поле *height* установите значение `200px`. Из списка доступных источников данных выберите `orderDs`, после этого в поле *id* с помощью кнопки image:generate_id.png[] сгенерируйте идентификатор таблицы: `ordersTable`.
+
image::qs_customer_screen_table.png[align="center"]

* Для сохранения изменений в экране редактирования Покупателя нажмите на кнопку *OK* в верхней панели.

[[qs_run]]
=== Запуск приложения

Посмотрим, как созданные нами экраны выглядят в работающем приложении. Для этого выполните *Run* > *Start application server*.

Зайдите в систему, использовав стандартные имя и пароль в окне логина. Откройте пункт меню *Shop* > *Customers*:

[[figure_customerBrowse]]
.Экран списка Customers
image::qs_customer_browse.png[align="center"]

Нажмите на кнопку *Create* и создайте нового покупателя:

[[figure_customerEdit]]
.Экран редактирования Customer
image::qs_customer_edit.png[align="center"]

Откройте пункт меню *Shop* > *Orders*:

[[figure_orderBrowse]]
.Экран списка Orders
image::qs_order_browse.png[align="center"]

Нажмите на кнопку *Create* и создайте новый заказ, выбрав в поле *Customer* только что созданного покупателя:

[[figure_orderEdit]]
.Экран редактирования Order
image::qs_order_edit.png[align="center"]

В таблице на экране редактирования покупателя теперь отображается только что созданный заказ:

[[figure_customerEdit]]
.Экран редактирования Customer
image::qs_customer_edit_2.png[align="center"]
