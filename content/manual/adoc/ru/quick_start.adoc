[[quick_start]]
== Быстрый старт

В данном разделе рассматривается создание приложения при помощи CUBA Studio. Эта же информация изложена в видеороликах, доступных по адресу link:$$https://www.cuba-platform.ru/quickstart$$[www.cuba-platform.ru/quickstart].

На Вашей рабочей машине уже должно быть установлено и настроено необходимое программное обеспечение, см. <<setup,>>.

Основные задачи, стоящие при разработке нашего приложения:

. Разработка модели данных, которая заключается в создании сущностей предметной области и соответствующих таблиц базы данных.

. Разработка экранов пользовательского интерфейса, позволяющих создавать, просматривать, обновлять и удалять сущности модели данных.

[[qs_app_details]]
=== Описание задачи

Приложение предназначено для ведения сведений о покупателях и их заказах. 

Покупатель имеет следующие характеристики:

* Имя

* Электронная почта

Характеристики заказа:

* Принадлежность покупателю

* Дата

* Сумма

Пользовательский интерфейс приложения должен содержать:

* Окно списка покупателей;

* Окно редактирования сведений о покупателе, содержащее также список заказов данного покупателя;

* Окно общего списка заказов;

* Окно редактирования заказа.

Приложение должно поддерживать русский и английский язык интерфейса.

[[qs_create_project]]
=== Создание проекта

. Запустите *CUBA Studio* и откройте ее веб-интерфейс (см. <<cubaStudio_install,Установка CUBA Studio>>).

. Нажмите на кнопку *Create new*.

. В отобразившемся окне *Select project* нажмите на кнопку *New*.

. В окне *New project* в поле *Project name* введите имя проекта - `sales`. Имя должно содержать только латинские буквы, цифры и знак подчеркивания. Тщательно продумайте имя проекта на данном этапе, так как в дальнейшем его невозможно изменить без сложного ручного вмешательства.

. В полях ниже автоматически сгенерируются:

* *Project path* − путь к каталогу нового проекта. Каталог можно выбрать вручную, нажав на кнопку `*...*` рядом с полем. Отобразится окно *Folder select* со списком папок на жестком диске. Вы можете выбрать одну из них или создать новый каталог, нажав на кнопку *+*.

* *Project namespace* - пространство имен, которое будет использоваться как префикс имен сущностей и таблиц базы данных. Пространство имен может состоять только из латинских букв, и должно быть как можно короче. Например, если имя проекта - `++sales_2++`, то пространство имен может быть `sales` или `sal`.

* *Root package* − корневой пакет Java-классов. Может быть скорректирован позже, однако сгенерированные на этапе создания классы перемещены не будут.

* *Platform version* - используемая в проекте версия платформы. Артефакты платформы будут автоматически загружены из репозитория при сборке проекта.
+
Оставим все предложенные значения без изменений.

. Нажмите на кнопку *OK*. В указанном каталоге `sales` будет создан пустой проект, и откроется главное окно Studio.

. Сборка проекта. Выберите пункт главного меню Studio *Build* → *Assemble project*. На этом этапе будут загружены все необходимые библиотеки и в подкаталогах `build` модулей будут собраны <<artifact,артефакты>> проекта.

. Создание базы данных на локальном сервере *HyperSQL*. Выберите пункт меню *Run* → *Create database*. Имя БД по умолчанию совпадает с пространством имен проекта.

. Выберите пункт меню *Run* → *Deploy*. В подкаталоге `build` проекта будет установлен сервер *Tomcat* с собранным приложением.

. Выберите пункт меню *Run* → *Start application server*. Через несколько секунд в панели статуса ссылка рядом с надписью *Web application* станет доступной, и по ней можно осуществить переход к приложению непосредственно из Studio.
+
Логин и пароль пользователя − `admin` / `admin`.
+
Запущенное приложение содержит два главных пункта меню (*Администрирование* и *Помощь*), функциональность подсистемы безопасности и администрирования системы.

[[qs_create_entities]]
=== Создание сущностей

Создадим класс сущности Покупатель (Customer).

* Перейдите на вкладку *Entities* на панели навигатора и нажмите на кнопку *New entity*. Появится диалоговое окно *New entity*.

* В поле *Class name* введите название класса сущности − `Customer`.
+
 
+
image::qs_create_customer_entity.png[align="center"]

 

* Нажмите *OK*. В рабочей области откроется страница дизайнера сущности.
+
 
+
image::qs_customer_entity.png[align="center"]

 

* В полях *Name* и *Table* автоматически сгенерируются имя сущности и имя таблицы в базе данных.

* В поле *Parent class* оставьте установленное значение − `StandardEntity`.

* Поле *Inheritance strategy* оставьте пустым.

* Нажмите на кнопку image:localization.png[] рядом с полем *Name*. На экране отобразится окно *Localized message*, в нем следует задать <<localization,локализацию>> имени сущности на доступных языках.

Далее создадим атрибуты сущности. Для этого нажмите на кнопку *New*, находящуюся под таблицей *Attributes*.

* В отобразившемся окне *Create attribute* в поле *Name* введите название атрибута сущности − `name`, в списке *Attribute type* выберите значение `DATATYPE`, в поле *Type* укажите тип атрибута `String` и далее укажите длину текстового атрибута в поле *Length*, равной 100 символам. Установите флажок *Mandatory*. В поле *Column* автоматически сгенерируется имя колонки таблицы в базе данных.
+
 
+
image::qs_new_attribute.png[align="center"]

 
+
Далее нажмите на кнопку image:localization.png[] рядом с названием атрибута. На экране отобразится окно *Localized message*, в нем следует задать локализацию названия атрибута на доступных языках. 
+
Для добавления атрибута нажмите на кнопку *Add*.

* Атрибут `email` создается таким же образом, за исключением того, что в поле *Length* следует указать значение `50`.

После создания атрибутов перейдите на вкладку *Instance name* дизайнера сущности для задания <<namePattern,Name pattern>>. В списке *Available attributes* выделите атрибут *name* и перенесите его в список *Name pattern attributes* нажав на кнопку с изображением стрелки вправо.

image::qs_customer_instance_name.png[align="center"]

На этом создание сущности Customer завершено. Нажмите на кнопку *OK* в верхней панели для сохранения изменений.

Создадим сущность Заказ (Order). В панели *Entities* нажмите на кнопку *New entity*. В поле *Class name* введите название класса сущности − `Order`. Сущность должна иметь следующие атрибуты: 

* *Name* − `customer`, *Attribute type* − `ASSOCIATION`, *Type* − `Customer`, *Cardinality* − `++MANY_TO_ONE++`.

* *Name* − `date`, *Attribute type* − `DATATYPE`, *Type* − `Date`. Для атрибута `date` установите флажок *Mandatory*.

* *Name* − `amount`, *Attribute type* − `DATATYPE`, *Type* − `BigDecimal`.

Для каждого атрибута укажите <<localization,локализованные>> названия нажимая на кнопку image:localization.png[] рядом с именем атрибута.

[[qs_create_db_tables]]
=== Создание таблиц базы данных

Для <<db_update_in_dev,создания таблиц базы данных>> достаточно на вкладке *Entities* панели навигатора нажать на кнопку *Generate DB scripts*. После этого откроется страница *Database scripts*. На вкладке будут сгенерированы скрипты обновления базы данных от ее текущего состояния (*Update scripts*) и скрипты создания базы данных с нуля (*Init tables*, *Init constraints*, *Init data*). Также на вкладке будут доступны уже выполненные скрипты обновления базы данных, если они есть. 

 

image::qs_generate_db_scripts.png[align="center"]

 

Чтобы сохранить сгенерированные скрипты, нажмите на кнопку *Save and close*. Для запуска скриптов обновления остановите запущенное приложение с помощью команды *Run* → *Stop application server*, затем выполните *Run* → *Update database*.

[[qs_create_ui]]
=== Создание экранов пользовательского интерфейса

Создадим экраны приложения, позволяющие управлять информацией о Покупателях и Заказах.

[[qs_create_customer_screens]]
==== Экраны управления Покупателями

Для создания стандартных экранов просмотра и редактирования Покупателей необходимо выделить сущность `Customer` на вкладке *Entities* панели навигатора и нажать на кнопку *Create standard screens* внизу панели. После этого на экране отобразится страница *Create standard screens*.

 

image::qs_create_customer_screens.png[align="center"]

 

Все поля этого окна заполнены значениями по умолчанию, менять их не нужно. Нажмите на кнопку *Create*.

Во вкладке *Screens* панели навигатора в модуле *GUI Module* появятся элементы `customer-edit.xml` и `customer-browse.xml`. 

Для экранов можно задать <<localization,локализацию>> заголовков. Для этого выделите один из файлов и нажмите на кнопку *Edit*. Отобразится страница дизайнера экрана. Перейдите на вкладку *Properties*. Нажмите на кнопку image:localization.png[] рядом с полем *Caption* и задайте локализованные заголовки экрана. Повторите те же действия для другого экрана. Для редактирования всех локализованных сообщений экранов сразу можно воспользоваться элементом `messages.properties`, расположенным в том же пакете, что и экраны. Выделите его и нажмите *Edit*, в появившемся редакторе задайте сообщения `browseCaption` и `editCaption` на доступных языках.

[[qs_create_order_screens]]
==== Экраны управления Заказами

Сущность Заказ (Order) имеет следующую особенность: так как среди прочих атрибутов существует ссылочный атрибут `Order.customer`, требуется определить <<views,представление>> сущности `Order`, включающее этот атрибут (стандартное представление `++_local++` не включает ссылочных атрибутов).

Для этого перейдите на вкладку *Entities* на панели навигатора, выделите сущность `Order` и нажмите на кнопку *New view*. Отобразится страница дизайнера представлений. В качестве имени введите `orderWithCustomer`, в списке атрибутов нажмите на атрибут `customer` и на отобразившейся справа панели выберите представление `++_minimal++` для сущности `Customer`.

 

image::qs_order_view.png[align="center"]

 

 Нажмите на кнопку *OK* в верхней панели.

Далее выделите сущность `Order` и нажмите на кнопку *Create standard screens*. В отобразившемся окне *Create standard screens* выберите значение `orderWithCustomer` в полях *View* для браузера и редактора и нажмите на кнопку *Create*.

 

image::qs_create_order_screens.png[align="center"]

 

Во вкладке *Screens* панели навигатора в модуле *GUI Module* появятся элементы `order-edit.xml` и `order-browse.xml`.

Вы можете задать локализованные заголовки экранов аналогично описанному для экранов Покупателя.

[[qs_create_menu]]
==== Меню приложения

При создании экраны были добавлены в пункт меню *application*, имеющийся по умолчанию. Переменуем его. Для этого перейдите на вкладку *Main menu* на панели навигатора и нажмите на кнопку *Edit*. Отобразится страница дизайнера меню. Выделите пункт меню `application` для просмотра его свойств. 

В поле *Id* введите новое значение идентификатора меню − `shop`, нажмите на кнопку *Caption* *edit* и задайте локализованное название пункта меню.

 

image::qs_application_menu.png[align="center"]

 

После редактирования меню нажмите на кнопку *OK* в верхней панели.

[[qs_customer_edit_with_orders]]
==== Экран редактирования Покупателя со списком Заказов

Займемся задачей отображения списка Заказов в окне редактирования Покупателя.

* Перейдите на вкладку *Screens* на панели навигатора. Выделите экран `customer-edit.xml` и нажмите на кнопку *Edit*.

* На странице дизайнера экрана перейдите на вкладку *Datasources* и нажмите на кнопку *New*.

* Выделите только что созданный <<datasources,источник данных>> в списке. В правой части страницы отобразятся его характеристики.

* В поле *Type* укажите `collectionDatasource`.

* В поле *Id* введите значение идентификатора источника данных − `ordersDs`.

* В списке *Entity* выберите сущность `com.sample.sales.entity.Order`.

* В списке *View* выберите представление `++_local++`.

* В поле *Query* введите следующий <<datasource_query,запрос>>: 
+
[source, jpql]
----
select o from sales$Order o where o.customer.id = :ds$customerDs order by o.date
----
+
Здесь запрос содержит условие отбора Заказов с параметром `ds$customerDs`. Значением параметра с именем вида `++ds${datasource_name}++` будет идентификатор сущности, установленной в данный момент в источнике данных `++datasource_name++`, в данном случае − идентификатор редактируемого Покупателя.
+
 
+
image::qs_customer_screen_orders_ds.png[align="center"]

 

* Нажмите на кнопку *Apply* для сохранения изменений.

* Далее перейдите на вкладку *Layout* в дизайнере экрана и в палитре компонентов найдите компонент `Label`. Перетащите этот компонент на панель иерархии компонентов экрана, между `fieldGroup` и `windowActions`. Перейдите на вкладку *Properties* на панели свойств. В качестве значения поля *value* введите `msg://orders`. Нажмите на кнопку image:localization.png[] рядом с полем *value* и задайте локализованное значение надписи.
+
 
+
image::qs_customer_screen_label.png[align="center"]

 
+
[TIP]
====
Если разрабатываемое приложение не предполагает мультиязычности, в поле *value* можно ввести значение на требуемом языке.
====

* Перетащите компонент `Table` из палитры компонентов на панель иерархии компонентов между `label` и `windowActions`. Выделите компонент в иерархии и на панели свойств на вкладке *Layout* задайте размеры таблицы: в поле *width* укажите `100%`, в поле *height* установите значение `200px`. Перейдите на вкладку *Properties*. В качестве идентификатора укажите значение `ordersTable`, из списка доступных источников данных выберите `orderDs`.
+
 
+
image::qs_customer_screen_table.png[align="center"]

 
* Для сохранения изменений в экране редактирования Покупателя нажмите на кнопку *OK* в верхней панели.

[[qs_run]]
=== Запуск приложения

Посмотрим, как созданные нами экраны выглядят в работающем приложении. Для этого выполните *Run* → *Restart application*.

Зайдите в систему, выбрав русский язык в окне логина. Откройте пункт меню *Продажи* → *Покупатели*:

[[figure_customerBrowse]]
.Экран списка Покупателей
image::qs_customer_browse.png[align="center"]

Нажмите на кнопку *Создать*:

[[figure_customerEdit]]
.Экран редактирования Покупателя
image::qs_customer_edit_2.png[align="center"]

Откройте пункт меню *Продажи* → *Заказы*:

[[figure_orderBrowse]]
.Экран списка Заказов
image::qs_order_browse.png[align="center"]

Нажмите на кнопку *Создать*:

[[figure_orderEdit]]
.Экран редактирования Заказа
image::qs_order_edit.png[align="center"]

 

