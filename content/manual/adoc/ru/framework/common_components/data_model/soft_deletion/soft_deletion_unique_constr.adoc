:sourcesdir: ../../../../../../source

[[soft_deletion_unique_constr]]
====== Ограничение уникальности на уровне БД

В режиме мягкого удаления для ограничения уникальности некоторого значения необходимо обеспечить существование единственной неудаленной записи с этим значением, и произвольного количества удаленных записей с этим же значением.

Реализуется данная логика путем, специфичным для используемого сервера базы данных:

* Если сервер БД поддерживает частичные (partial) индексы (например, *PostgreSQL*), то ограничение уникальности можно создать следующим образом:
+
[source, sql]
----
create unique index IDX_SEC_USER_UNIQ_LOGIN on SEC_USER (LOGIN_LC) where DELETE_TS is null
----
+
* Если сервер БД не поддерживает частичные индексы (например, *Microsoft SQL Server 2005*), то в уникальный индекс можно включить поле *DELETE_TS*:

[source, sql]
----
create unique index IDX_SEC_USER_UNIQ_LOGIN on SEC_USER (LOGIN_LC, DELETE_TS)
----

