:sourcesdir: ../../../../../source

[[url_navigation_api_usage]]
===== Использование механизма навигации и истории просмотров URL

Этот раздел содержит примеры использования механизма навигации и истории просмотров URL.

Предположим, у нас есть сущность `Task` и экран `TaskInfo` с информацией о выбранной задаче.

Контроллер экрана `TaskInfo` содержит аннотацию `@Route` для указания маршрута к экрану:

[source, java]
----
include::{sourcesdir}/gui/url_taskStatistic_screen.java[]
----

В результате пользователь может открыть экран, введя `++http://localhost:8080/app/#main/task-info++` в адресной строке:

image::url_screen_by_route.png[align="center"]

Когда экран открыт, адрес также содержит метку состояния.

[[mapping_state_to_url]]
Отображение состояния на URL::
+
--
Предположим, на экране `TaskInfo` отображается информация об одной задаче и присутствует элемент управления для переключения задач. Вы можете отобразить просматриваемую задачу в адресной строке, чтобы иметь возможность скопировать URL-адрес, а затем открыть экран для этой конкретной задачи, вставив URL-адрес в адресную строку.

Следующий код реализует отображение выбранной задачи на URL-адрес:

[source, java]
----
include::{sourcesdir}/gui/url_mapStateToUrl.java[]
----

<1> - получить текущую задачу из `LookupField`
<2> - удалить параметры URL, если задача не выбрана
<3> - сериализовать идентификатор задачи с помощью вспомогательного класса `UrlIdSerializer`
<4> - заменить текущее состояние URL-адреса новым, содержащим в качестве параметра сериализованный идентификатор задачи.

В результате URL-адрес приложения изменяется, когда пользователь выбирает задачу и нажимает кнопку *Select Task*:

image::url_reflection_state.png[align="center"]
--

[[using_urlParamsChangedEvent]]
UrlParamsChangedEvent::
+
--

Теперь давайте выполним последнее требование: когда пользователь вводит URL с маршрутом и параметром `task_id`, приложение должно показать экран с соответствующей выбранной задачей. Ниже приведен полный код контроллера экрана.

[source, java]
----
include::{sourcesdir}/gui/url_paramsChangedEvent_listener.java[]
----

<1> - получить значение параметра из `UrlParamsChangedEvent`
<2> - десериализовать идентификатор задачи
<3> - загрузить экземпляр задачи и установить его в поле `LookupField`
--