:sourcesdir: ../../../../../source

[[gui_data_loaders]]
===== Загрузчики данных

Загрузчики, или loaders, предназначены для загрузки данных со среднего слоя в <<gui_data_containers,контейнеры данных>>.

Интерфейсы загрузчиков немного отличаются в зависимости от типа контейнера, с которым они работают:

* `InstanceLoader` загружает единственный экземпляр сущности в контейнер `InstanceContainer` по идентификатору сущности или с помощью JPQL-запроса.

* `CollectionLoader` загружает коллекцию сущностей в `CollectionContainer` с помощью JPQL-запроса. Для этого загрузчика можно настроить пагинацию, сортировку и другие дополнительные параметры.

* `KeyValueCollectionLoader` загружает коллекцию экземпляров `KeyValueEntity` в контейнер `KeyValueCollectionContainer`. Кроме параметров, доступных для `CollectionLoader`, вы также можете указать имя <<data_store,хранилища данных>>.

В XML-дескрипторах экрана загрузчики объявляются с помощью элемента `<loader>`, тип загрузчика будет определяться типом контейнера, в который он вложен.

Использование загрузчиков необязательно, так как вы можете загружать данные с помощью `DataManager` или собственного сервиса и самостоятельно добавлять их в контейнеры, однако загрузчики облегчают этот процесс для экранов, описываемых декларативно, особенно в случае компонента <<gui_Filter,Filter>>. Обычно загрузчик коллекций получает запрос JPQL из XML-дескриптора экрана, а параметры запроса - из компонента `Filter`, затем создаёт объект `LoadContext` и вызывает `DataManager` для загрузки сущностей. В итоге, XML-дескриптор выглядит подобным образом:

[source, xml]
----
include::{sourcesdir}/gui/data_loaders/loader_1.xml[]
----

Дополнительные параметры для XML-элемента `loader` можно указать с помощью атрибутов `cacheable`, `softDeletion` и т.д.

В экране редактора сущности XML-элемент `loader` обычно пуст, так как для загрузки единственного экземпляра сущности требуется её идентификатор, который устанавливается программно классом `StandardEditor`:

[source, xml]
----
include::{sourcesdir}/gui/data_loaders/loader_2.xml[]
----

Загрузчики могут делегировать непосредственно загрузку данных отдельной функции, переданной с помощью метода `setLoadDelegate()` либо декларативно с помощью аннотации `@Install` в контроллере экрана, например:

[source, java]
----
include::{sourcesdir}/gui/data_loaders/loader_3.java[]
----

В данном примере метод `customersDlLoadDelegate()` используется загрузчиком `customersDl` для получения списка экземпляров сущности `Customer`. Метод принимает `LoadContext`, который будет создан загрузчиком на основе его параметров: запрос, фильтр (при наличии) и т.д. В этом примере загрузка осуществляется через интерфейс `DataManager`, который функционально повторяет стандартную реализацию загрузчика, однако вы можете использовать собственный сервис или же выполнить пост-обработку загруженных сущностей.

Загрузчики также можно создавать и настраивать программно, к примеру:

[source, java]
----
include::{sourcesdir}/gui/data_loaders/loader_4.java[]
----

Если для загрузчика установлен <<gui_DataContext,DataContext>> (как всегда бывает в случае, если загрузчик задан в XML-дескрипторе), все загруженные сущности будут автоматически помещены в data context.
