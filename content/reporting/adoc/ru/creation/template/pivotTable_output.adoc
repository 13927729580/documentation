:sourcesdir: ../../../../source

[[pivotTable_output]]
==== Вывод отчета в виде Pivot Table

Шаблон Pivot Table доступен, если проект приложения включает https://doc.cuba-platform.com/charts-latest/[компонент *charts*]. Больше информации о компоненте Pivot Table вы можете найти в https://doc.cuba-platform.com/charts-latest/pivotTable.html[документации по *Charts*].

Для использования этого шаблона выберите Pivot Table в поле формата вывода в редакторе шаблона отчета. Результирующая таблица выводится в экране *Reports* -> *Show Pivot Tables* веб-приложения.

image::pivot_template_result.png[align="center"]

При использовании шаблона Pivot Table генератор отчетов получает данные из полосы и представляет их в виде сводной таблицы с поддержкой функциональности drag-and-drop, агрегации и вывода итоговых значений. Для построения отчета может быть использована только одна полоса, вложенные полосы не поддерживаются.

Настройки отрисовки::

Вкладка позволяет указать один или несколько рендереров (отрисовщиков), которые будут отображаться в списке доступных для выбора рендереров в UI, а также указать рендерер по умолчанию.

image::pivot_template_renderer.png[align="center"]

Настройки агрегации данных::

Вкладка *Aggregation options* позволяет задать список агрегаторов для таблицы. Для агрегаторов доступны следующие атрибуты:

* *Mode* - выбор из списка предопределенных функций,
* *Caption* - локализуемое значение, которое будет отображаться в UI,
* *Custom function* - если поле не пустое, вместо выбранного режима для агрегации будет использована заданная в поле функция JavaScript.

image::pivot_template_aggregation.png[align="center"]

Используемые поля::

Сводная таблица может отображать свойства из <<structure,наборов данных>> всех типов. Для корректной обработки алиасы ссылочных атрибутов из наборов SQL, JPQL и Groovy не должны содержать точек, например, `select u.name as "userName"`. Выбранные поля из этих наборов нужно указать в качестве атрибутов сводной таблицы на вкладке *Properties options* редактора шаблона:

* *Row*, *Column* - коллекция ключ-значение атрибутов таблицы, которые будут использоваться в качестве строк и столбцов, где ключ - имя атрибута в источнике данных, а значение - его локализованное значение, используемое при отображении,
* *Aggregation* - настройки для функции, которая будет использоваться для агрегирования значений в каждой ячейке,
* *Derived property* - используется для добавления новых генерированных атрибутов к источнику данных таблицы. Представляет собой коллекцию ключ-значение, где ключ - имя генерированного атрибута, а значение - JavaScript функция для генерации значения этого атрибута.

image::pivot_template_properties.png[align="center"]

Пользовательские настройки::

* *Filter function* - JavaScript код, который будет использоваться в качестве функции фильтрации,
* *Sorters function* - JavaScript код, который будет использоваться в качестве функции сортировки заголовков строк и столбцов,
* Переопределяемые функции отрисовки, в зависимости от выбранного рендерера. В данный момент только два типа рендереров могут быть кастомизированы:
+
** все виды `heatmap`. Можно задать JavaScript-функцию генерации цвета для ячеек,
+
** все виды графиков. Можно задать размер графика.

image::pivot_template_custom_properties.png[align="center"]

