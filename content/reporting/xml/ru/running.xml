<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<chapter id="running" lang="ru">
  <title>Запуск отчетов</title>
  <para>В данном разделе рассматриваются способы запуска созданных отчетов на выполнение.</para>
  <section id="run_common">
    <title>Запуск из общего списка отчетов</title>
    <para>Простейший способ запуска отчетов - из общего списка, доступного в экране <guimenu>Reports</guimenu> -&gt; <guimenu>Run Reports</guimenu>. Для этого у пользователя должно быть право на открытие данного экрана. В списке будут присутствовать все отчеты, <link linkend="permissions">доступные пользователю</link> в соответствии с его ролью. Если для отчета заданы внешние параметры, они будут запрошены при запуске отчета в специальной форме.</para>
  </section>
  <section id="run_actions">
    <title>Запуск отчетов из экранов</title>
    <para>Отчеты можно запускать из произвольных экранов системы, используя специальные действия и связанные с ними кнопки или элементы контекстного меню компонентов. При этом кроме доступности отчета в соответствии с ролью пользователя проверяется также его <link linkend="permissions">принадлежность</link> данному экрану.</para>
    <para>Рассмотрим типы действий и примеры их использования.</para>
    <itemizedlist>
      <listitem>
        <para><code>com.haulmont.reports.gui.actions.RunReportAction</code> - действие, отображающее список всех доступных отчетов. При выборе пользователем отчета из списка отображается форма ввода параметров (если они заданы), и отчет запускается на исполнение.</para>
        <para>Пример использования действия совместно с кнопкой, объявленной в XML-дескрипторе экрана:<itemizedlist>
            <listitem>
              <para>XML-дескриптор<programlisting language="xml">&lt;layout&gt;
    &lt;table id=&quot;bookTable&quot;&gt;
        ...
        &lt;buttonsPanel id=&quot;buttonsPanel&quot;&gt;
            ...          
            &lt;button id=&quot;reportButton&quot;
                    icon=&quot;icons/reports-print.png&quot;/&gt;
        &lt;/buttonsPanel&gt;
    &lt;/table&gt;</programlisting></para>
            </listitem>
            <listitem>
              <para>Контроллер<programlisting language="java">@Inject
private Button reportButton;

@Override
public void init(Map&lt;String, Object&gt; params) {
    reportButton.setAction(new RunReportAction(&quot;report&quot;, this));
}</programlisting></para>
            </listitem>
            <listitem>
              <para>messages.properties</para>
              <programlisting>report = Report</programlisting>
            </listitem>
          </itemizedlist></para>
      </listitem>
      <listitem>
        <para><code>com.haulmont.reports.gui.actions.TablePrintFormAction</code> - действие, связанное с таблицей, отображающей список экземпляров сущности. Действие отбирает только те отчеты, которые имеют внешний параметр типа <guilabel>Entity</guilabel> или <guilabel>List of entities</guilabel>, и тип сущности параметра совпадает с типом сущности, отображаемой таблицей. Если в результате отбора доступен только один отчет, он сразу запускается на выполнение. Если доступно несколько отчетов, их список предлагается пользователю.</para>
        <para>В отчет передается значение внешнего параметра по следующим правилам:<itemizedlist>
            <listitem>
              <para>Если параметр типа <guilabel>List of entities</guilabel>, то в него передается список выбранных в данный момент в таблице экземпляров.</para>
            </listitem>
            <listitem>
              <para>Если параметр типа <guilabel>Entity</guilabel>, и в таблице выбран один экземпляр (выделена одна строка), то в отчет передается этот экземпляр.</para>
            </listitem>
            <listitem>
              <para>Если параметр типа <guilabel>Entity</guilabel>, а в таблице выделено несколько строк, то отчет выполняется несколько раз по числу выбранных экземпляров. После выполнения пользователю возвращается один ZIP архив, в котором находятся все сформированные отчеты.</para>
            </listitem>
          </itemizedlist></para>
        <para>Пример использования с кнопкой и контекстным меню таблицы:<itemizedlist>
            <listitem>
              <para>XML-дескриптор<programlisting language="xml">&lt;layout&gt;
    &lt;table id=&quot;bookTable&quot;&gt;
        ...
        &lt;buttonsPanel id=&quot;buttonsPanel&quot;&gt;
            ...          
            &lt;button id=&quot;reportButton&quot;
                    icon=&quot;icons/reports-print.png&quot;/&gt;
        &lt;/buttonsPanel&gt;
    &lt;/table&gt;</programlisting></para>
            </listitem>
            <listitem>
              <para>Контроллер<programlisting language="java">@Inject
private Button reportButton;

@Inject
private Table bookTable;

@Override
public void init(Map&lt;String, Object&gt; params) {
    TablePrintFormAction action = new TablePrintFormAction(&quot;report&quot;, this, bookTable);
    bookTable.addAction(action);
    reportButton.setAction(action);
}</programlisting></para>
            </listitem>
            <listitem>
              <para>messages.properties<programlisting>report = Report</programlisting></para>
            </listitem>
          </itemizedlist></para>
      </listitem>
      <listitem>
        <para><code>com.haulmont.reports.gui.actions.EditorPrintFormAction</code> - действие, связанное с экраном редактирования экземпляра сущности. Действие отбирает только те отчеты, которые имеют внешний параметр типа <guilabel>Entity</guilabel> или <guilabel>List of entities</guilabel>, и тип сущности параметра совпадает с типом редактируемой сущности. Если в результате отбора доступен только один отчет, он сразу запускается на выполнение. Если доступно несколько отчетов, их список предлагается пользователю.</para>
        <para>В отчет передается значение внешнего параметра - экземпляр редактируемой сущности. Если тип параметра - <guilabel>List of entities</guilabel>, то передается список из одного элемента.</para>
        <para>Пример использования с кнопкой, размещенной рядом со стандартными  кнопками <guibutton>OK</guibutton> и <guibutton>Cancel</guibutton>:<itemizedlist>
            <listitem>
              <para>XML-дескриптор<programlisting id="" language="xml">&lt;layout expand=&quot;windowActionsBox&quot;&gt;
    ...
    &lt;hbox id=&quot;windowActionsBox&quot;
          spacing=&quot;true&quot;&gt;
        &lt;iframe id=&quot;windowActions&quot;
                screen=&quot;editWindowActions&quot;/&gt;
        &lt;button id=&quot;reportButton&quot;/&gt;
    &lt;/hbox&gt;
&lt;/layout&gt;</programlisting></para>
            </listitem>
            <listitem>
              <para>Контроллер<programlisting language="java">@Inject
private Button reportButton;

@Override
public void init(Map&lt;String, Object&gt; params) {
    reportButton.setAction(new EditorPrintFormAction(&quot;report&quot;, this, null));
}</programlisting></para>
            </listitem>
            <listitem>
              <para>messages.properties<programlisting>report = Report</programlisting></para>
            </listitem>
          </itemizedlist></para>
      </listitem>
    </itemizedlist>
  </section>
</chapter>
