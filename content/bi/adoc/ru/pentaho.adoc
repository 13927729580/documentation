[[setup_pentaho]]
== Установка и настройка Pentaho

. Скачайте и установите Pentaho с http://www.pentaho.com/download

. Остановите фоновые процессы _Pentaho Server_ и _Pentaho Solution Repository_ в службах Windows Services или их аналоге.

. Измените порт Pentaho по умолчанию на 8081.
+
--
* Перейдите в папку `$PENTAHO_HOME/server/pentaho-server/tomcat/conf`, где `$PENTAHO_HOME` - папка, в которую установлен Pentaho.

* Измените порт Tomcat по умолчанию на 8081 в файле `server.xml`:

[source,xml]
----
include::{sourcesdir}/bi_port.xml[]
----
--

. Настройте аутентификацию пользователей CUBA в Pentaho.
+
--
* Скачайте https://dl.bintray.com/cuba-platform/main/com/haulmont/addon/bi/cuba-bi-pentaho/{addonVer}/cuba-bi-pentaho-{addonVer}.jar и скопируйте его в папку `$PENTAHO_HOME$/server/pentaho-server/tomcat/webapps/pentaho/WEB-INF/lib`.

* Создайте новый файл `cuba-pentaho-authentication.xml` в папке `$PENTAHO_HOME/server/pentaho-server/pentaho-solutions/system` со следующим содержимым:
+
[source,xml]
----
include::{sourcesdir}/cuba-pentaho-authentication.xml[]
----
+
[TIP]
====
Укажите URL вашего приложения CUBA в свойстве `cubaConnectionUrl` бина `cubaAuthenticationFilter`.
====

* Отредактируйте файл `pentaho-spring-beans.xml` в папке `pentaho-solutions/system`, добавив в него строку `<import resource="cuba-pentaho-authentication.xml" />` после строки `<import resource="applicationContext-spring-security.xml" />`:
+
[source,xml]
----
include::{sourcesdir}/bi_beans.xml[]
----
--

. Снова запустите фоновые процессы _Pentaho Server_ и _Pentaho Solution Repository_ в службах Windows Services или их аналоге.
